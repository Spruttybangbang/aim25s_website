<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Svenska företag som använder AI & ML -- databas</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700;900&family=Source+Serif+4:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="/static/companies/css/public_view.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Svenska företag som använder AI & ML</h1>
            <p class="subtitle subtitle-clickable" onclick="openReleaseNotesModal()">Version 1.1 | Senast uppdaterad 2025-12-18</p>

            <!-- Global action icons -->
            <div class="global-actions">
                <button class="global-icon-btn" onclick="openHelpModal()" title="Hjälp att förstå databasen" aria-label="Hjälp">
                    <span class="material-symbols-outlined icon">help_center</span>
                </button>
                <button class="global-icon-btn" onclick="openSuggestionModal()" title="Föreslå nytt företag" aria-label="Föreslå företag">
                    <span class="material-symbols-outlined icon">add_box</span>
                </button>
                <button class="global-icon-btn" onclick="window.location.href='/logout/'" title="Logga ut" aria-label="Logga ut">
                    <span class="material-symbols-outlined icon">logout</span>
                </button>
            </div>
        </header>

        <!-- Unified Search & Filter Section (3-column layout) -->
        <div class="unified-filter-section">
            <div class="filter-grid">
                <!-- Column 1: Filter Sections -->
                <div class="filter-column dropdowns-column">
                    <!-- Bransch Filter Section (Collapsible) -->
                    <div class="filter-section" data-filter="bransch">
                        <h4 class="filter-header" onclick="toggleFilterSection('bransch')">
                            <span>Bransch</span>
                            <span class="filter-toggle">▼</span>
                        </h4>
                        <div class="filter-content" id="branschCheckboxContainer">
                            <!-- Populated dynamically from API -->
                        </div>
                    </div>

                    <!-- AI/ML-tillämpning Filter Section (Collapsible) -->
                    <div class="filter-section" data-filter="tillampning">
                        <h4 class="filter-header" onclick="toggleFilterSection('tillampning')">
                            <span>AI/ML-tillämpning</span>
                            <span class="filter-toggle">▼</span>
                        </h4>
                        <div class="filter-content">
                            <div class="checkbox-group-vertical">
                                <label class="filter-checkbox tillampning-checkbox">
                                    <input type="checkbox" name="tillampning" value="Optimering & Automation">
                                    <span>Optimering & Automation</span>
                                </label>
                                <label class="filter-checkbox tillampning-checkbox">
                                    <input type="checkbox" name="tillampning" value="Språk & Ljud">
                                    <span>Språk & Ljud</span>
                                </label>
                                <label class="filter-checkbox tillampning-checkbox">
                                    <input type="checkbox" name="tillampning" value="Prognos & Prediktion">
                                    <span>Prognos & Prediktion</span>
                                </label>
                                <label class="filter-checkbox tillampning-checkbox">
                                    <input type="checkbox" name="tillampning" value="Infrastruktur & Data">
                                    <span>Infrastruktur & Data</span>
                                </label>
                                <label class="filter-checkbox tillampning-checkbox">
                                    <input type="checkbox" name="tillampning" value="Insikt & Analys">
                                    <span>Insikt & Analys</span>
                                </label>
                                <label class="filter-checkbox tillampning-checkbox">
                                    <input type="checkbox" name="tillampning" value="Visuell AI">
                                    <span>Visuell AI</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Anställda Filter Section (Collapsible) -->
                    <div class="filter-section" data-filter="anstallda">
                        <h4 class="filter-header" onclick="toggleFilterSection('anstallda')">
                            <span>Anställda</span>
                            <span class="filter-toggle">▼</span>
                        </h4>
                        <div class="filter-content" id="anstalldaCheckboxContainer">
                            <!-- Populated dynamically from API -->
                        </div>
                    </div>

                    <!-- Omsättning Filter Section (Collapsible) -->
                    <div class="filter-section" data-filter="omsattning">
                        <h4 class="filter-header" onclick="toggleFilterSection('omsattning')">
                            <span>Omsättning</span>
                            <span class="filter-toggle">▼</span>
                        </h4>
                        <div class="filter-content" id="omsattningCheckboxContainer">
                            <!-- Populated dynamically from API -->
                        </div>
                    </div>
                </div>

                <!-- Column 2: Search & Checkboxes -->
                <div class="filter-column search-column">
                    <input type="text" id="searchInput"
                           placeholder="Sök företag, stad, kommun..." autocomplete="off">

                    <div class="search-buttons-row">
                        <button id="searchButton">Sök</button>
                        <button id="luckyButton" class="btn-lucky">
                            <span class="btn-lucky-text">I feel lucky</span>
                            <span class="btn-lucky-loading" style="display: none;">
                                <span class="loading-dots">Slumpar</span>
                            </span>
                        </button>
                    </div>

                    <div class="checkbox-group">
                        <label class="filter-checkbox">
                            <input type="checkbox" id="stockholmFilter">
                            <span>Endast stor-Stockholm</span>
                        </label>

                        <label class="filter-checkbox">
                            <input type="checkbox" id="arbetsgivareFilter">
                            <span>Endast registrerade arbetsgivare</span>
                        </label>
                    </div>

                    <button id="clearFilters" class="btn-clear-filters">Rensa alla filter</button>
                </div>

                <!-- Column 3: Chart -->
                <div class="filter-column stats-column">
                    <!-- Batteristapel visualisering -->
                    <div class="battery-container">
                        <!-- Hjälptext över batteriet -->
                        <div class="battery-help-text">
                            Klicka här för mer datainfo <span class="battery-arrow">↓</span>
                        </div>
                        <!-- Batteristapel -->
                        <div class="battery-bar">
                            <div class="battery-background"></div>
                            <div class="battery-fill" id="batteryFill" style="height: 100%;"></div>
                            <div class="battery-counter" id="batteryCounter">0</div>
                        </div>
                        <!-- Label under stapeln -->
                        <div class="battery-label">Antal företag</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Filter Pills Section (NEW) -->
        <div id="activeFiltersContainer" class="active-filters-container" style="display: none;">
            <div class="active-filters-pills" id="activeFiltersPills">
                <!-- Pills generated dynamically -->
            </div>
        </div>

        <!-- Legacy stats element (kept for compatibility) -->
        <div style="display: none;">
            <span id="totalCompanies">Laddar...</span>
        </div>

        <!-- Loading spinner -->
        <div id="loadingSpinner" class="loading">
            <div class="spinner"></div>
            <p>Laddar företag...</p>
        </div>

        <!-- Error message -->
        <div id="errorMessage" class="error-message" style="display: none;">
            <p>Ett fel uppstod vid laddning av data. Försök igen.</p>
        </div>

        <!-- Desktop Table View -->
        <div class="table-container desktop-view">
            <table id="companiesTable">
                <thead>
                    <tr id="tableHeaders">
                        <!-- Headers will be populated dynamically -->
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Data will be populated dynamically -->
                </tbody>
            </table>
        </div>

        <!-- Mobile Card View -->
        <div class="cards-container mobile-view" id="mobileCards">
            <!-- Cards will be populated dynamically -->
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination">
            <button id="prevPage" disabled>Föregående</button>
            <span id="pageInfo">Sida 1 av 1</span>
            <button id="nextPage" disabled>Nästa</button>
        </div>
    </div>

    <!-- Modal for Company Details -->
    <div id="companyModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalBody">
                <!-- Company details will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Modal for Error Reporting -->
    <div id="errorReportModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeErrorReportModal()">&times;</span>
            <div id="errorReportBody">
                <h2>Rapportera fel</h2>
                <p class="error-report-subtitle">Hjälp oss förbättra informationen om <span id="errorCompanyName"></span></p>

                <form id="errorReportForm">
                    <input type="hidden" id="errorCompanyId" name="company_id">

                    <div class="form-group">
                        <label for="errorType">Typ av fel *</label>
                        <select id="errorType" name="error_type" required>
                            <option value="">Välj feltyp...</option>
                            <option value="incorrect_info">Felaktig information</option>
                            <option value="company_not_exist">Företaget finns ej</option>
                            <option value="missing_data">Saknad data</option>
                            <option value="other">Annat</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="errorDescription">Beskrivning av felet *</label>
                        <textarea id="errorDescription" name="description" rows="4" required placeholder="Beskriv vad som är fel..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="errorSuggestion">Förslag på korrigering</label>
                        <textarea id="errorSuggestion" name="suggestion" rows="3" placeholder="Om du vet den korrekta informationen, skriv den här..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeErrorReportModal()">Avbryt</button>
                        <button type="submit" class="btn-primary">Skicka felanmälan</button>
                    </div>
                </form>

                <div id="errorReportSuccess" style="display: none;">
                    <p class="success-message">✓ Tack för din felanmälan! Vi kommer att granska den så snart som möjligt.</p>
                    <button class="btn-primary" onclick="closeErrorReportModal()">Stäng</button>
                </div>

                <div id="errorReportError" style="display: none;">
                    <p class="error-message">✗ Något gick fel. Försök igen senare.</p>
                    <button class="btn-secondary" onclick="closeErrorReportModal()">Stäng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content modal-wide">
            <span class="close" onclick="closeHelpModal()">&times;</span>
            <div id="helpModalBody">
                <h2>Hjälp att förstå databasen</h2>

                <div class="help-content">
                    <p>Denna databas har samlat företag från officiella källor (såsom AI Sweden och EU) som listar AI-företag i Sverige. Denna data has sedan korskörts med Bolagsverkets information på företagen och sedan harmoniserats med hjälp av generativ AI.</p>

                    <p>Databasen kan innehålla fel eller gammal data, om du upptäcker något fel får du gärna rapportera det. Du kan också föreslå företag som bör finnas med på listan, du hittar det formuläret bredvid ikonen till denna hjälptext.</p>

                    <h3>Förklaringar</h3>

                    <h4>Bransch</h4>
                    <p>Denna etikett beskriver företagets primära kundgrupp eller den industri där deras lösning gör mest nytta. Vi delar in detta i vertikala branscher och horisontella teknikområden.</p>

                    <h5>Vertikala kluster (Marknader)</h5>
                    <p>Dessa företag applicerar AI för att lösa specifika problem inom en viss industri.</p>
                    <ul>
                        <li><strong>Energy & ClimateTech:</strong> Lösningar för energisystem, hållbarhet, miljöanalys och grön teknik (Cleantech).</li>
                        <li><strong>FinTech:</strong> Bank, finans och försäkring. Innefattar bedrägeridetektion, riskanalys och automatiserad ekonomihantering.</li>
                        <li><strong>HealthTech & Life Science:</strong> Vård, medicinsk diagnostik, läkemedelsutveckling (Drug Discovery) och bioteknik.</li>
                        <li><strong>Industrial & Manufacturing:</strong> Tillverkningsindustri, robotik, fabriksautomation och "Industry 4.0".</li>
                        <li><strong>Logistics & Mobility:</strong> Allt som rör förflyttning av varor och människor. Innefattar fordonsutveckling, autonoma system, transportplanering och supply chain-optimering.</li>
                        <li><strong>Public Sector:</strong> Lösningar riktade mot offentlig sektor, myndigheter, kommuner, försvar och samhällsservice.</li>
                        <li><strong>Retail & E-commerce:</strong> Detaljhandel och e-handel. Fokus på kundanalys, lagerhantering och köpupplevelser.</li>
                    </ul>

                    <h5>Horisontella kluster (Teknik & Tjänster)</h5>
                    <p>Dessa företag erbjuder teknik eller tjänster som kan användas av flera olika branscher.</p>
                    <ul>
                        <li><strong>Consulting & Enterprise:</strong> Konsultbolag som hjälper andra att implementera AI, samt breda affärssystem (SaaS) som effektiviserar interna processer (HR, sälj, admin).</li>
                        <li><strong>Core AI/ML & Research:</strong> Företag som bygger själva grundtekniken, plattformar för maskininlärning (MLOps) eller bedriver tung forskning.</li>
                        <li><strong>GenAI & NLP:</strong> Specialister inom språkteknologi och generativ AI. Här hittar du textanalys, chattbotar och verktyg för att skapa innehåll.</li>
                    </ul>

                    <h4>AI/ML-tillämpningar</h4>
                    <p>Denna kolumn beskriver <em>vad</em> AI-tekniken faktiskt gör hos företaget. Ett företag kan ha en eller flera tillämpningsområden.</p>

                    <ul>
                        <li><strong>Optimering & Automation:</strong> Företag som använder AI för att optimera processer, schemaläggning, logistik eller automatisera arbetsflöden. Inkluderar RPA (Robotic Process Automation), robotstyrning och matematisk optimering.</li>

                        <li><strong>Språk & Ljud:</strong> Företag som arbetar med språkteknologi och ljudanalys. Inkluderar chattbotar, generativ AI för text, talsyntes (TTS), taligenkänning (STT), översättning och ljudanalys.</li>

                        <li><strong>Prognos & Prediktion:</strong> Företag som använder AI för att förutspå framtida händelser baserat på historisk data. Inkluderar försäljningsprognoser, riskanalys, rekommendationsmotorer och prediktiv underhåll.</li>

                        <li><strong>Infrastruktur & Data:</strong> Företag som bygger infrastruktur och verktyg för AI/ML. Inkluderar MLOps-plattformar, datapipelines, datavisualisering, edge AI, digital twins och syntetisk data.</li>

                        <li><strong>Insikt & Analys:</strong> Företag som använder AI för att analysera data och ge insikter. Inkluderar anomalidetektion, beslutstöd, graf-analys, sentiment-analys och smarta söksystem.</li>

                        <li><strong>Visuell AI:</strong> Företag som arbetar med datorseende och bildanalys. Inkluderar objektdetektering, ansiktsigenkänning, medicinsk bildanalys, OCR, videoanalytik, autonom navigation och kvalitetskontroll.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Company Suggestion Modal -->
    <div id="suggestionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSuggestionModal()">&times;</span>
            <div id="suggestionModalBody">
                <h2>Föreslå nytt företag</h2>
                <p class="suggestion-subtitle">Hjälp oss bygga en komplett databas över AI-företag i Sverige</p>

                <form id="suggestionForm">
                    <div class="form-group">
                        <label for="suggestionCompanyName">Företagsnamn *</label>
                        <input type="text" id="suggestionCompanyName" name="company_name" required placeholder="T.ex. AI Solutions AB">
                    </div>

                    <div class="form-group">
                        <label for="suggestionWebsite">Hemsida *</label>
                        <input type="url" id="suggestionWebsite" name="website" required placeholder="https://exempel.se">
                    </div>

                    <div class="form-group">
                        <label for="suggestionAdditionalInfo">Ytterligare information (frivilligt)</label>
                        <textarea id="suggestionAdditionalInfo" name="additional_info" rows="3" placeholder="Berätta gärna mer om företaget och varför det bör läggas till..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeSuggestionModal()">Avbryt</button>
                        <button type="submit" class="btn-primary">Skicka förslag</button>
                    </div>
                </form>

                <div id="suggestionSuccess" style="display: none;">
                    <p class="success-message">✓ Tack för ditt företagsförslag! Vi kommer att granska det så snart som möjligt.</p>
                    <button class="btn-primary" onclick="closeSuggestionModal()">Stäng</button>
                </div>

                <div id="suggestionError" style="display: none;">
                    <p class="error-message">✗ Något gick fel. Försök igen senare.</p>
                    <button class="btn-secondary" onclick="closeSuggestionModal()">Stäng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Database Insights Modal -->
    <div id="databaseModal" class="modal">
        <div class="modal-content modal-wide">
            <span class="close" onclick="closeDatabaseModal()">&times;</span>

            <h2 style="font-family: 'Playfair Display', serif; font-weight: 700; margin-bottom: 2rem;">
                Database Insights
            </h2>

            <div id="databaseInsightsContainer" style="max-height: 70vh; overflow-y: auto; padding-right: 1rem;">

                <!-- Översikt Section -->
                <div class="insight-section">
                    <h3>Översikt</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-number" id="statTotalCompanies">0</span>
                            <span class="stat-label">Företag totalt</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">37</span>
                            <span class="stat-label">Variabler data</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">22 817</span>
                            <span class="stat-label">Celler data</span>
                        </div>
                    </div>
                </div>

                <!-- Geografisk Spridning Section -->
                <div class="insight-section">
                    <h3>Geografisk Spridning</h3>
                    <p class="section-description">Distribution av företag per stad (topp 5 + övriga)</p>
                    <div class="chart-container">
                        <canvas id="geographicChart"></canvas>
                    </div>
                </div>

                <!-- Branschfördelning Section -->
                <div class="insight-section">
                    <h3>Branschfördelning</h3>
                    <p class="section-description">Distribution av företag per branschkluster</p>
                    <div class="chart-container">
                        <canvas id="branschChart"></canvas>
                    </div>
                </div>

                <!-- Tillämpningar Section -->
                <div class="insight-section">
                    <h3>AI-Tillämpningar</h3>
                    <p class="section-description">Antal företag per tillämpningsområde</p>
                    <div class="chart-container">
                        <canvas id="applicationsChart"></canvas>
                    </div>
                </div>

                <!-- Omsättning Section -->
                <div class="insight-section">
                    <h3>Omsättningsfördelning</h3>
                    <p class="section-description">Företag grupperade efter omsättning</p>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <!-- Anställda Section -->
                <div class="insight-section">
                    <h3>Företagsstorlek (Anställda)</h3>
                    <p class="section-description">Företag grupperade efter antal anställda</p>
                    <div class="chart-container">
                        <canvas id="employeesChart"></canvas>
                    </div>
                </div>

                <!-- Data Source Footer -->
                <div class="insight-footer">
                    <p><strong>Datakälla:</strong> AIM25S Företagsdatabas</p>
                    <p><em>Uppdaterad: 2025-12-15</em></p>
                </div>

            </div>
        </div>
    </div>

    <!-- Release Notes Modal -->
    <div id="releaseNotesModal" class="modal">
        <div class="modal-content modal-medium">
            <span class="close" onclick="closeReleaseNotesModal()">&times;</span>

            <h2 style="font-family: 'Playfair Display', serif; font-weight: 700; margin-bottom: 2rem;">
                Version History
            </h2>

            <!-- Version 1.1 -->
            <div class="release-section">
                <div class="release-header">
                    <h3>Version 1.1</h3>
                    <span class="release-date">2025-12-18</span>
                </div>

                <ul>
                    <li>Klickbar database insights dashboard med Chart.js visualiseringar</li>
                    <li>Multi-select filter för alla kategorier</li>
                    <li>6 nya AI/ML-tillämpningsfält ersätter AI-inriktning</li>
                    <li>Server-side filtering (visar alla matchande företag)</li>
                    <li>Expanderbara filter sections</li>
                </ul>
            </div>

            <!-- Version 1.0 -->
            <div class="release-section">
                <div class="release-header">
                    <h3>Version 1.0</h3>
                    <span class="release-date">2025-12-12</span>
                </div>

                <ul>
                    <li>Interaktiv företagsdatabas med 613 AI-företag</li>
                    <li>Sök- och filterfunktion</li>
                    <li>Batterimätare och "I feel lucky" button</li>
                    <li>Rapportera fel och föreslå företag</li>
                    <li>Editorial design aesthetic</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="/static/companies/js/public_view.js"></script>
</body>
</html>
